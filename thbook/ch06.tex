\chapter Appendix.

\subchapter Compilation.

If you want to compile the Therion source code, you need 

\list
* GNU C/C++ compiler
* GNU make
* Tcl
* Perl
\endlist

For Windows consider using MinGW (|http://www.mingw.org|).
It's a distribution of GNU utilities with GNU make and GCC.

\subsubchapter Quick start.

\list
* unpack source distribution |therion-0.2.*.tar.gz|
* |cd therion|
* |make config-macosx| or |make config-win32|, if you use MacOS~X or Windows, 
  respectively
* |make|
* |make install|
\endlist

\subsubchapter Hacker's guide.

\penalty-20
{\it Make parameters}

Therion's {\it makefile} may take some optional parameters.

\list
* |config-linux|, |config-macosx|, |config-win32| = configure Therion for a 
  specific platform. Linux is a default.
* |config-release|, |config-oxygen|, |config-ozone| = set optimization level 
  for C++ compiler (none, |-O2| and |-O3|)  
* |config-debug| = useful before debugging the program  
* |depend| = find dependencies for include files
* |install| = install Therion
* |clean| = delete all temporary files
\endlist

\penalty-20
{\it Adding new encodings}

Although UTF-8 Unicode encoding covers all characters which Therion is able to 
process, it may be inconveniet to use it. In that case it's possible to add 
support for any 8-bit encoding for text input files. Copy a translation file to 
the |thchencdata| directory; add its name to `ifiles' hash in the beginning of 
the Perl script |generate.pl|; run it and recompile Therion.

The translation file should contain two hexadecimal values of a character 
(first one in the 8-bit encoding, second one in Unicode) in each line. Possible 
comments follow the `|#|' character. 

\penalty-20
{\it Adding new \TeX\ encodings}

It's easy to add new encodings for 2D map output. Copy an appropriate encoding 
mapping file with an |*.enc| extension to the |texenc/encodings|, run the Perl 
script |mktexenc.pl| located in the |texenc| directory and compile Therion.

Therion uses the same encoding files as |afm2tfm| program from the \TeX\ 
distribution, which has the same format as an encoding vector in a PostScript 
font. You may find more details in the chapter {\it 6.3.1.5 Encoding file 
format} in the documentation to Dvips program.


\penalty-20
{\it Generating new \TeX\ and \MP\ headers}

Therion uses \TeX\ and \MP\ for 2D map visualization and typesetting. 
Predefined macros are compiled into the Therion executable and are copied to 
the working directory just before running \MP\ and \TeX\ (unless the 
|--use-extern-libs| option is used). Layout command makes it possible to modify 
some macros in the configuration file at the run-time. 

However, it's possible to make permanent changes to the macro files. After 
modifying the files in the |mpost| and |tex| directories it's necessary to run 
Perl scripts |genmpost.pl| and |gentex.pl|, which generate C++ header files, 
and compile Therion executable again.

\subchapter Environment variables.

Therion reads following environment variables:

\list
* |THERION| = [not required] search path for (x)therion.ini file(s)
* |HOME| (|HOMEDRIVE| + |HOMEPATH| on WinXP) = 
  [not required, but usually present on your system] search path 
  for (x)therion.ini file(s)
* |TEMP|, |TMP| = system temporary directory, where Therion stores temporary 
  files (in a directory named |th$PID$|, where |$PID$| is a process ID),
  unless |tmp-path| is specified in the initialization file.
\endlist

Consult the documentation of your OS how to set them.

\subchapter Initialization files.

Therion's and XTherion's system dependent settings are specifyed in the 
file therion.ini or xtherion.ini, respectively.
They are searched in the following directories:

\list
* on UNIX: 
  |$THERION|, |$HOME/.therion|, |/etc|, |/usr/etc|, |/usr/local/etc|
* on WINDOWS:
  |$THERION|, |$HOME/.therion|, |<Therion-installation-directory>|, 
  |C:\WINDOWS|, |C:\WINNT|, |C:\Program Files\Therion|
\endlist
 
\subsubchapter Therion.

If no file is found Therion uses its default settings. If you want to list
them, use |--print-init-file| option. The initialization file is read 
like any other therion file. (Empty lines or lines starting with `|#|' are 
ignored; lines ending with a backslash continue on next line.) Currently 
supported initialization commands follow.

\list
* |encoding_default <encoding-name>|

  Set the default output encoding.
        
* |mpost-path <file-path>|

  Set the full path to a \MP\ executable (``|mpost|'' is the default).

* |pdftex-path <file-path>|

  Set the full path to a pdf\TeX\ executable (``|pdfetex|'' is the default).

* |cavern-path <file-path>|

  Path to |cavern| program. In most cases not necessary.

* |source-path <directory>| 

  Path to data and configuration files. Used mostly for system-wide grades and 
  layout definitions.

* |tmp-path <directory>| 

  Path to temporary directory.
  
* |tmp-remove <OS command>| 

  System command to delete files from the temporary directory.

* |tex-fonts <encoding> <rm> <it> <bf> <ss> <si>|
        
  Set-up fonts used for given encoding. The list of currently supported 
  encodings gives the |--print-tex-encodings| command line option.   
  The same encoding must be used while generating \TeX\ metrics (|*.tfm| files) 
  for those fonts (e.g.~with the afm2tfm program) and this encoding must be
  explicitly given also in the pdf\TeX's map file. The only exception is the 
  base set of Computern Modern fonts, which use `raw' encoding. This encoding
  doesn't need to be specified in the pdf\TeX's map file.
  
  Encoding has to be followed by five font specifications for regular, italic,
  bold, sans-serif and sans-serif oblique styles.
  Default setting is |tex-fonts raw cmr10 cmti10 cmbx10 cmss10 cmssi10|
  
  Example how to use other fonts (e.g.~TrueType Palatino in xl2 (an encoding 
  derived from ISO8859-2) encoding). Run:
  
  |ttf2afm -e xl2.enc -o palatino.afm palatino.ttf|
  
  |afm2tfm palatino.afm -u -v vpalatino -T xl2.enc|

  |vptovf vpalatino.vpl vpalatino.vf vpalatino.tfm|
  
  You get files |vpalatino.vf|, |vpalatino.tfm| and |palatino.tfm|. Add the line 
  
  |palatino <xl2.enc <palatino.ttf|
  
  to the pdf\TeX's map file. The same should be done for the italic and bold
  faces and corresponding sansserif and sansserifoblique fonts. If you're lazy
  try 
  
  |tex-fonts xl2 palatino palatino palatino palatino palatino|
  
  (We should use actually virtual font |vpalatino| instead of |palatino|,
  which contains no kerning or ligatures, but
  pdf\TeX\ doesn't support |\pdfincludechars| command on virtual fonts.
  To be improved.)
    
  If you want to add some unsupported encodings, 
  read the chapter {\it Compilation / Hacker's guide}. 
\endlist


\subsubchapter XTherion.

Initialization file for XTherion is actually a Tcl script evaluated when 
XTherion starts. The file is commented; see the comments for details.


%\subsubchapter Speed optimization.
%
%[Optionally creating \MP\ and \TeX\ format files.]


%\subchapter Map symbols library.

%\input sym/symlib

\subchapter History.

\list
\everypar{\hangindent16pt\hangafter1}
* {\bf 1999}

  Oct: first concrete ideas

  Nov: start of programming (Perl scripts and \MP\ macros)

  Dec 27: Therion compiles simple map for the first time (32 kB of Perl and 
       \MP\ source code). This first release had some interesting features
       such as {\it transformation functions}, which alowed user-specification
       of the input format for survey data.
				
* {\bf 2000}

  Jan: xthedit (Tcl/Tk), a graphical front-end for Therion

  Feb 18: start of (first?) reprogramming (Perl)

  Apr 1: first hyperlinked PDF cave map 

  Aug: experiments with PDF, pdf\TeX\ and \MP

* {\bf 2001}

  Nov: start of reimplementation from scratch: 
       Therion (C++ with some Perl scripts inherited from the previous version); 
       interactive 2D map editor ThEdit as a replacement of xthedit (Delphi) 

  Dec: ThEdit exports simple map for the first time

* {\bf 2002}

  Mar: Therion 0.1 ---
       Therion is able to process survey data (centreline) of Dead Bats Cave.
       XTherion, text editor designed for Therion (Tcl/Tk).

  Jul 27: Therion 0.2 ---
       Therion compiles simple map (consisting of two scraps)
       for the first time (800 kB of source code)

  Aug: XTherion extended to 2D map editor (as a replacement of ThEdit)

  Sep: Therion compiles first real and complex map of a cave. XTherion
       extended to compiler.

%  Oct 5: Public presentation of Therion, held on Trango\v{s}ka

* {\bf 2003}

  Mar: First version of The Therion Book finished

  Apr: Therion included in Debian GNU/Linux

  Jun: all Perl scripts rewritten in C++, Therion is one executable program
       now (although using Survex and TeX)
       
%  Nov 10: ...
\endlist


\subchapter Future.

Although Therion is already used for map production, there are a lot of 
new features to be implemented:

\subsubchapter General.

\list
* comprehensive information on centreline processing and loop closure
\endlist

\subsubchapter 2D maps.

\list
* map legend
* debugging mode
* SVG support
\endlist


\subsubchapter 3D models.

\list
* passage walls modelling
* OpenGL 3D viewer as a part of XTherion
\endlist

\endinput
